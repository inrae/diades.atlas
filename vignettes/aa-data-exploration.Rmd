---
title: "aa-partie-exploration-des-donnees"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{aa-partie-exploration-des-donnees}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE # Set to TRUE when data OK for test, but not on GitHub
)
```

```{r setup}
library(diades.atlas)
# renv::install("dm")
library(dm)
library(dplyr)
```

## Data exploration

### Connect to database
```{r}
Sys.setenv(POSTGIS_HOST = "postgis")
postgis_host <- Sys.getenv("POSTGIS_HOST")

con <- DBI::dbConnect(
  RPostgres::Postgres(), 
  host = postgis_host,
  dbname = "diades",
  port = 5432,
  user = "diadesatlas_r",
  password = "diadesPassword"
)
# Listtables
# DBI::dbListTables(con)
# DBI::dbListObjects(con)

all_schemas <- DBI::dbGetQuery(con, "SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA")
all_schemas

casestudy <- tbl(con, dbplyr::in_schema("diadesatlas", "casestudy"))
```

### Create connection

```{r}
my_dm <- dm_from_src(con, schema = "diadesatlas", learn_keys = TRUE)
my_dm
```

### Stop connection

```{r}
DBI::dbDisconnect(con)
```

